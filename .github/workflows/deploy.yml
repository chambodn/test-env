name: Deploy in environment

on:
  workflow_call:
    inputs:
      execution_environment:
        required: true
        type: string

jobs:
  check-status:
    name: check-status
    runs-on: ubuntu-latest
    steps:
      - uses: dorny/paths-filter@v2
        id: changes
        with:
          list-files: shell
          filters: |
            sandbox:
              - 'live/sandbox/**'
            dev:
              - 'live/dev/**'
            pre:
              - 'live/pre/**'
            prod:
              - 'live/prod/**'
            envcommon:
              - '_envcommon/**'
      
      - name: Check
        if: |
          steps.filter.outputs.sandbox == 'true' &&
          inputs.execution_environment != 'sandbox'
        run: |
          echo "Be careful you are updated sandbox files targeting ${{steps.filter.outputs.sandbox_files}}"
 
  deploy:
    name: deploy
    needs: check-status
    environment: ${{ inputs.execution_environment }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploy"
